<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang ƒê·ªçc Truy·ªán</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      color: #333;
    }

    header {
      background: #2d89ef;
      color: white;
      padding: 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    main {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      min-height: calc(100vh - 160px);
    }

    .truyen-card {
      width: 180px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      overflow: hidden;
      text-align: center;
      transition: 0.2s;
      cursor: pointer;
    }

    .truyen-card:hover {
      transform: translateY(-4px);
    }

    .truyen-card img {
      width: 100%;
      height: 240px;
      object-fit: cover;
    }

    .truyen-card h3 {
      padding: 10px;
      font-size: 16px;
      margin: 0;
    }

    footer {
      background: #2d89ef;
      color: white;
      text-align: center;
      padding: 10px;
      margin-top: auto;
    }

    /* Styles for reading page */
    .reading-container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .chapter-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .chapter-controls select, .chapter-controls button {
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      font-size: 16px;
      cursor: pointer;
    }

    .chapter-controls button:hover {
      background: #f0f0f0;
    }

    .chapter-title {
      text-align: center;
      margin: 10px 0 20px;
      font-size: 24px;
    }

    .manga-page {
      width: 100%;
      margin-bottom: 10px;
      text-align: center;
    }

    .manga-page img {
      max-width: 100%;
      height: auto;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .page-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }

    .hidden {
      display: none;
    }

    .loading {
      text-align: center;
      padding: 20px;
      font-size: 18px;
    }

    .home-btn {
      position: absolute;
      left: 15px;
      top: 15px;
      padding: 5px 10px;
      background: white;
      color: #2d89ef;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .error-message {
      color: red;
      text-align: center;
      padding: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìñ Web ƒê·ªçc Truy·ªán</h1>
    <button class="home-btn" onclick="goHome()">Trang ch·ªß</button>
  </header>

  <main id="main-content">
    <div id="truyen-list">
      <!-- Danh s√°ch truy·ªán s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
    </div>

    <div id="reading-page" class="hidden">
      <div class="reading-container">
        <div class="chapter-controls">
          <button id="prev-chap">Chap tr∆∞·ªõc</button>
          <select id="chap-select"></select>
          <button id="next-chap">Chap sau</button>
        </div>
        <h2 class="chapter-title" id="chapter-title"></h2>
        <div id="manga-pages"></div>
        <div class="page-controls">
          <button id="prev-page">Trang tr∆∞·ªõc</button>
          <span id="page-indicator">Trang 1/1</span>
          <button id="next-page">Trang sau</button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>Made with ‚ù§Ô∏è by xFear</p>
  </footer>

  <script>
    // Danh s√°ch truy·ªán
    const truyenList = [
      {
        ten: "Manhwa1",
        folder: "Manhwa1",
        cover: "Manhwa1/bg.jpg",
        soChap: 97
      }
    ];

    // Bi·∫øn to√†n c·ª•c
    let currentTruyen = null;
    let currentChap = 1;
    let currentPage = 1;
    let totalPages = 0;

    // Kh·ªüi t·∫°o trang
    document.addEventListener('DOMContentLoaded', function() {
      renderTruyenList();
      
      // X·ª≠ l√Ω s·ª± ki·ªán navigation
      document.getElementById('prev-chap').addEventListener('click', goToPrevChap);
      document.getElementById('next-chap').addEventListener('click', goToNextChap);
      document.getElementById('prev-page').addEventListener('click', goToPrevPage);
      document.getElementById('next-page').addEventListener('click', goToNextPage);
      document.getElementById('chap-select').addEventListener('change', function() {
        goToChap(parseInt(this.value));
      });
    });

    // Render danh s√°ch truy·ªán
    function renderTruyenList() {
      const listEl = document.getElementById("truyen-list");
      listEl.innerHTML = '';

      truyenList.forEach(truyen => {
        const card = document.createElement("div");
        card.className = "truyen-card";
        card.innerHTML = `
          <img src="${truyen.cover}" alt="${truyen.ten}" onerror="this.src='https://via.placeholder.com/180x240?text=·∫¢nh+b√¨a'">
          <h3>${truyen.ten}</h3>
          <p>${truyen.soChap} ch∆∞∆°ng</p>
        `;
        card.addEventListener('click', () => openTruyen(truyen));
        listEl.appendChild(card);
      });
    }

    // M·ªü truy·ªán ƒë·ªÉ ƒë·ªçc
    function openTruyen(truyen) {
      currentTruyen = truyen;
      currentChap = 1;
      
      // ·∫®n danh s√°ch, hi·ªán trang ƒë·ªçc
      document.getElementById('truyen-list').classList.add('hidden');
      document.getElementById('reading-page').classList.remove('hidden');
      
      // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ
      document.querySelector('header h1').textContent = `üìñ ${truyen.ten}`;
      
      // T·∫°o dropdown ch·ªçn chap
      const chapSelect = document.getElementById('chap-select');
      chapSelect.innerHTML = '';
      for (let i = 1; i <= truyen.soChap; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `Ch∆∞∆°ng ${i}`;
        if (i === currentChap) option.selected = true;
        chapSelect.appendChild(option);
      }
      
      // Load chap ƒë·∫ßu ti√™n
      loadChap(currentChap);
    }

    // Quay l·∫°i trang ch·ªß
    function goHome() {
      document.getElementById('reading-page').classList.add('hidden');
      document.getElementById('truyen-list').classList.remove('hidden');
      document.querySelector('header h1').textContent = 'üìñ Web ƒê·ªçc Truy·ªán';
      currentTruyen = null;
    }

    // Load n·ªôi dung chap
    function loadChap(chapNumber) {
      if (!currentTruyen) return;
      
      currentChap = chapNumber;
      currentPage = 1;
      
      // C·∫≠p nh·∫≠t dropdown
      document.getElementById('chap-select').value = chapNumber;
      document.getElementById('chapter-title').textContent = `${currentTruyen.ten} - Ch∆∞∆°ng ${chapNumber}`;
      
      // Hi·ªÉn th·ªã tr·∫°ng th√°i loading
      const mangaPages = document.getElementById('manga-pages');
      mangaPages.innerHTML = '<div class="loading">ƒêang t·∫£i...</div>';
      
      // Ki·ªÉm tra s·ªë trang trong chap
      detectTotalPages(chapNumber);
    }

    // Ph√°t hi·ªán s·ªë trang trong chap
    function detectTotalPages(chapNumber) {
      // Th·ª≠ t·∫£i ·∫£nh ƒë·∫ßu ti√™n ƒë·ªÉ ki·ªÉm tra chap c√≥ t·ªìn t·∫°i kh√¥ng
      const testImage = new Image();
      testImage.onload = function() {
        // N·∫øu ·∫£nh ƒë·∫ßu ti√™n t·ªìn t·∫°i, ti·∫øp t·ª•c ki·ªÉm tra s·ªë trang
        checkPageExists(chapNumber, 1, 1);
      };
      testImage.onerror = function() {
        // N·∫øu chap kh√¥ng t·ªìn t·∫°i, th·ª≠ chap tr∆∞·ªõc ƒë√≥
        if (chapNumber > 1) {
          loadChap(chapNumber - 1);
        } else {
          // N·∫øu kh√¥ng c√≥ chap n√†o t·ªìn t·∫°i
          const mangaPages = document.getElementById('manga-pages');
          mangaPages.innerHTML = '<div class="error-message">Kh√¥ng t√¨m th·∫•y chap n√†o. Vui l√≤ng ki·ªÉm tra ƒë∆∞·ªùng d·∫´n ·∫£nh.</div>';
          totalPages = 0;
          updatePageControls();
        }
      };
      // ƒê·ªãnh d·∫°ng t√™n file: Manhwa1/Chap1/Chap1\1.jpg
      testImage.src = `${currentTruyen.folder}/Chap${chapNumber}/Chap${chapNumber}\\1.jpg`;
    }

    // Ki·ªÉm tra trang c√≥ t·ªìn t·∫°i kh√¥ng
    function checkPageExists(chapNumber, pageNumber, foundPages) {
      const testImage = new Image();
      testImage.onload = function() {
        // N·∫øu trang t·ªìn t·∫°i, ki·ªÉm tra trang ti·∫øp theo
        checkPageExists(chapNumber, pageNumber + 1, foundPages + 1);
      };
      testImage.onerror = function() {
        // N·∫øu trang kh√¥ng t·ªìn t·∫°i, ƒë√¢y l√† trang cu·ªëi c√πng
        totalPages = foundPages;
        updatePageControls();
        loadPage(currentPage);
      };
      // ƒê·ªãnh d·∫°ng t√™n file: Manhwa1/Chap1/Chap1\1.jpg
      testImage.src = `${currentTruyen.folder}/Chap${chapNumber}/Chap${chapNumber}\\${pageNumber}.jpg`;
    }

    // C·∫≠p nh·∫≠t ƒëi·ªÅu khi·ªÉn trang
    function updatePageControls() {
      document.getElementById('page-indicator').textContent = `Trang ${currentPage}/${totalPages}`;
      
      // ·∫®n/hi·ªán n√∫t ƒëi·ªÅu h∆∞·ªõng
      document.getElementById('prev-page').disabled = (currentPage <= 1);
      document.getElementById('next-page').disabled = (currentPage >= totalPages);
      document.getElementById('prev-chap').disabled = (currentChap <= 1);
      document.getElementById('next-chap').disabled = (currentChap >= currentTruyen.soChap);
    }

    // Load trang c·ª• th·ªÉ
    function loadPage(pageNumber) {
      if (!currentTruyen || pageNumber < 1 || pageNumber > totalPages) return;
      
      currentPage = pageNumber;
      
      // C·∫≠p nh·∫≠t indicator
      updatePageControls();
      
      // Hi·ªÉn th·ªã ·∫£nh
      const mangaPages = document.getElementById('manga-pages');
      mangaPages.innerHTML = '';
      
      const img = document.createElement('img');
      // ƒê·ªãnh d·∫°ng t√™n file: Manhwa1/Chap1/Chap1\1.jpg
      img.src = `${currentTruyen.folder}/Chap${currentChap}/Chap${currentChap}\\${pageNumber}.jpg`;
      img.alt = `Trang ${pageNumber}`;
      img.onerror = function() {
        this.src = 'https://via.placeholder.com/800x1200?text=Kh√¥ng+t√¨m+th·∫•y+trang';
      };
      
      const pageDiv = document.createElement('div');
      pageDiv.className = 'manga-page';
      pageDiv.appendChild(img);
      mangaPages.appendChild(pageDiv);
      
      // Cu·ªôn l√™n ƒë·∫ßu trang
      window.scrollTo(0, 0);
    }

    // ƒêi·ªÅu h∆∞·ªõng gi·ªØa c√°c chap
    function goToPrevChap() {
      if (currentChap > 1) {
        loadChap(currentChap - 1);
      }
    }

    function goToNextChap() {
      if (currentTruyen && currentChap < currentTruyen.soChap) {
        loadChap(currentChap + 1);
      }
    }

    function goToChap(chapNumber) {
      if (chapNumber >= 1 && chapNumber <= currentTruyen.soChap) {
        loadChap(chapNumber);
      }
    }

    // ƒêi·ªÅu h∆∞·ªõng gi·ªØa c√°c trang
    function goToPrevPage() {
      if (currentPage > 1) {
        loadPage(currentPage - 1);
      } else if (currentChap > 1) {
        // N·∫øu ƒëang ·ªü trang ƒë·∫ßu, chuy·ªÉn ƒë·∫øn chap tr∆∞·ªõc
        goToPrevChap();
        // ƒê·∫∑t timeout ƒë·ªÉ ƒë·ª£i load chap m·ªõi xong r·ªìi m·ªõi load trang cu·ªëi
        setTimeout(() => {
          if (totalPages > 0) {
            loadPage(totalPages);
          }
        }, 300);
      }
    }

    function goToNextPage() {
      if (currentPage < totalPages) {
        loadPage(currentPage + 1);
      } else if (currentTruyen && currentChap < currentTruyen.soChap) {
        // N·∫øu ƒëang ·ªü trang cu·ªëi, chuy·ªÉn ƒë·∫øn chap sau
        goToNextChap();
      }
    }
  </script>
</body>
</html>